---
# Vector installation
vector_install: true

# Vector service configuration
vector_service_enabled: false  # Disabled by default
vector_service_state: stopped  # Stopped by default

# Vector configuration
vector_config_dir: "/etc/vector"
vector_config_file: "/etc/vector/vector.yaml"

# CloudWatch Logs configuration
# Can be overridden in group_vars or host_vars to match existing log groups
# Example: "/boundless/bento/dev" or "/boundless/bento/{{ stack_name }}"
vector_cloudwatch_log_group: "/boundless/bento/{{ hostvars[inventory_hostname]['ansible_hostname'] }}"
vector_cloudwatch_region: "us-west-2"
vector_cloudwatch_stream_name: "%Y-%m-%d"

# AWS Authentication
# Vector will use credentials in this order:
# 1. IAM instance profile (if running on EC2) - preferred method
# 2. AWS credentials file (~/.aws/credentials) - if vector_aws_credentials_file is set
# 3. Environment variables - if vector_aws_access_key_id and vector_aws_secret_access_key are set
# 4. Explicit credentials in Vector config - if vector_aws_access_key_id and vector_aws_secret_access_key are set
vector_aws_use_instance_profile: true  # Use IAM instance profile (preferred for EC2)
vector_aws_credentials_file: null  # Path to AWS credentials file (e.g., "/root/.aws/credentials")
vector_aws_access_key_id: null  # AWS access key ID (not recommended, use IAM roles instead)
vector_aws_secret_access_key: null  # AWS secret access key (not recommended, use IAM roles instead)

# Services to monitor (systemd units)
vector_monitor_services:
  - bento-api.service
  - bento-exec.service
  - bento-aux.service
  - bento-prove.service
  - broker.service
  - miner.service

# Vector buffer configuration
vector_buffer_type: "memory"
vector_buffer_max_size: 268435488  # 256MB
vector_buffer_when_full: "block"

# Vector log level
vector_log_level: "info"

# Prometheus metrics collection
vector_prometheus_enabled: true  # Enable Prometheus metrics scraping
vector_prometheus_scrape_interval_secs: 15  # Scrape interval in seconds

# Base ports for each service type (instances use base_port + instance_id)
# These must match bento_prometheus_metrics_ports in the bento role
vector_prometheus_base_ports:
  api: 9090
  prove: 9190
  exec: 9290
  aux: 9390
  snark: 9490
  join: 9490
  broker: 9590  # Broker uses port 9590
  miner: 9600   # Miner uses port 9600

# Service instance counts (used to generate endpoints for all instances)
# These should match bento_gpu_count, bento_exec_count, bento_aux_count from group_vars
# Only include services that actually expose Prometheus metrics
vector_prometheus_service_counts:
  api: 1  # API is always single instance
  prove: "{{ bento_gpu_count | default(1) }}"
  exec: "{{ bento_exec_count | default(4) }}"
  aux: "{{ bento_aux_count | default(2) }}"
  snark: "{{ bento_snark_count | default(0) }}"  # Snark workers (0 if not enabled)
  join: "{{ bento_join_count | default(0) }}"  # Join workers (0 if not enabled)
  broker: 1  # Broker is always single instance
  # miner: Not included - miner doesn't expose Prometheus metrics

# CloudWatch Metrics configuration
vector_cloudwatch_metrics_enabled: true  # Enable CloudWatch Metrics sink
vector_cloudwatch_metrics_namespace: "Boundless/Bento"  # CloudWatch Metrics namespace
vector_cloudwatch_metrics_region: "{{ vector_cloudwatch_region }}"
