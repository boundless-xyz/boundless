# Claiming Rewards

## What is "Proof of Verifiable Work"?

Proof of Verifiable Work (PoVW), a novel invention within Boundless, is a permissionless incentive mechanism which enables provers to be rewarded in $ZKC in exchange for their proving work on the Boundless marketplace or elsewhere. Provers generating unique zero-knowledge proofs are rewarded with $ZKC. This tutorial explains the process of claiming $ZKC rewards for provers who enable PoVW. 

:::note[Note]
This page introduces the concepts necessary to understand Proof of Verifiable Work (PoVW) and effectively claim rewards. For more information on PoVW, refer to section 2.3.1 of the [Boundless whitepaper](https://read.boundless.network/)* *and the “[Introducing ZK Coin](https://boundless.network/blog/introducing-zk-coin)” blog post.
:::

## Prerequisites

::::steps

#### Update to the latest release

PoVW was added to RISC Zero’s zkVM ([R0VM](https://github.com/risc0/risc0)) in version 3.0.1. PoVW support has been added to Bento; to enable PoVW requires release [v0.14.0](https://github.com/boundless-xyz/boundless/releases/tag/v0.14.0) and above. 

#### Install the Boundless CLI 

```bash
cargo install --locked boundless-cli
```

#### Install the latest version of Foundry

Some commands in this tutorial use [cast](https://getfoundry.sh/cast/overview) from the [Foundry toolkit](https://getfoundry.sh/). This is not necessary, but it will make some CLI commands more straightforward. 

#### Stop Bento Safely

To enable PoVW in Bento, first make sure to stop Bento safely. If Bento is backing the Broker, please carry out *Step 1* from [Safe Upgrade Steps](/provers/broker#safe-upgrade-steps) and then return to this page. 

If Bento is running without the Broker, Bento can be safely stopped with:

```bash
just bento down
```

#### Specify the Log ID Address

:::tip[Tip]
Provers can use their Log ID as their $ZKC staking address; for simplicity, the following tutorial uses the Log ID to stake $ZKC as well. In practice, provers may decide to use a separate wallet to stake $ZKC. For more information, see [Key Separation](#key-separation).
:::

Before starting Bento again, set the `POVW_LOG_ID` environment variable to a valid Ethereum address; provers will need the private key for this address later when using the PoVW CLI to prove and submit valid work to the PoVW contracts.  Please see [Reward Claiming Workflow](#reward-claiming-workflow)  for more information.

```bash
export POVW_LOG_ID="0x0000...0000"
export POVW_PRIVATE_KEY="..."
```

#### Start Bento

Once enabled, Bento can be run as normal with:

```bash
just bento
```

::::

Before continuing with the tutorial, it is recommended to read both the [Terminology](/provers/povw-claiming-rewards#terminology) and [Reward Claiming Workflow](/provers/povw-claiming-rewards#reward-claiming-workflow) sections before running the commands listed below.

## Claiming PoVW rewards

:::warning[You will require funds on Ethereum mainnet]
For all relevant commands below: `stake`, `delegate-rewards` and ` send-update`, the private key used for sending the Ethereum transactions is `POVW_PRIVATE_KEY`, i.e. the private key for the Log ID. Therefore, before `POVW_LOG_ID` will require funds on Ethereum mainnet to pay for gas. 
:::

::::steps

### Staking $ZKC

Before provers can begin contributing work to claim PoVW rewards, they must stake $ZKC. Once staked, provers are eligible for $ZKC rewards effective immediately i.e. starting from the reward epoch they staked in. Reward epochs are approximately 2 days long. 

* To check the current $ZKC balance of `POVW_LOG_ID`:

```bash
cast call ${POVW_LOG_ID:?} 'balanceOf(address) returns (uint256)' ${POVW_LOG_ID:?}
```

To stake 100 $ZKC, run the following command:

```bash
boundless zkc stake --amount $(cast parse-units 100 18)
```



To get the current epoch:

```bash
cast call ${ZKC_ADDRESS:?} 'getCurrentEpoch() returns (uint256)'
```

To get the end time for the current epoch:

```bash
cast call ${ZKC_ADDRESS:?} 'getEpochEndTime(uint256) returns (uint256)' ${EPOCH:?}
```

### Running Valid Work

Provers are now ready to run proving workloads with PoVW enabled; this can be done by [running a prover](/provers/quick-start) on the Boundless marketplace or elsewhere. For each proving job, R0VM will automatically generate [work receipts](#TODO). These work receipts track the amount of proving work done. Each epoch, provers will need to submit their accumulated work to the PoVW accounting smart contract. To do this, provers must use the PoVW CLI and run the following three commands, `prove-update`, `send-update` and `claim-reward`.

### Creating a New Work Log

Provers must first create a new work log, associated with the `POVW_LOG_ID`:

```bash
boundless povw prove-update --new ${POVW_LOG_ID} --state <STATE_FILE_LOCATION>
```

where `<STATE_FILE_LOCATION>` is something like: `~/folder/state.bin`.

### prove-update

Once provers have run some jobs, they can run `prove-update` from receipts stored in Bento:

```
boundless povw prove-update --state ~/tmp/zkc_test/state.bin --from-bento
```

`prove-update` compresses all work receipts and stores the work log update to the state file. This process is entirely local (i.e. it does not send any transaction). For this work to be eligible for $ZKC rewards from the PoVW contract, this work log update must now be sent onchain. 

### send-update

After running `prove-update`, provers are ready to post the work log update onchain:

```bash
boundless povw send-update --state <STATE_FILE> --rpc-url <RPC_URL> [--value-recipient <VALUE_RECIPIENT>](TODO)
```

### claim-reward

After the reward epoch has finalized, rewards can be claimed with:

```bash
boundless povw claim-rewards --beacon-chain-rpc <BEACON_CHAIN_RPC_ENDPOINT> --archive-node-rpc <ARCHIVE_NODE_RPC_ENDPOINT> --private_key <PRIVATE_KEY>
```

::::

## Terminology

* **Log ID:** This is the Ethereum address set with the `POVW_LOG_ID` environment variable. This address can be the same as the one used for a prover on the Boundless Market, but it doesn't have to be. See *Recommended Practices* for more information.  
* **Work Receipts:** For each proving workload, PoVW generates work receipts alongside the expected ZK proof. These work receipts are compressed into a “work log” update to post onchain. This work log update represents the combined work of all compressed work receipts. Work receipts are compressed using the `prove-update` CLI command, and this process is entirely local. **(link to prove-update CLI code in Boundless repo once merged)**  
* **Work Log:** The work log is a record of work tracked against a specific log ID i.e. it represents a tally of all work done by that address. A work log commitment prevents “double-spending” of verifiable work when claiming PoVW rewards. The work log is updated using the `send-update` CLI command, which takes a work log update (generated by `prove-update`) and updates the commitment onchain to reflect all the work done by the log ID since the last update.  
* **Reward Epoch:** The PoVW reward epoch is approximately 2 days. Verifiable work submitted within a given epoch is eligible for that epoch’s reward emissions.   
  * **To be eligible for these rewards, a prover must stake an amount of $ZKC** that scales with the size of their rewards for a given epoch. For more information, please see this [blog post](https://boundless.network/blog/introducing-zk-coin).

## Reward Claiming Workflow 

* Provers must stake $ZKC to be eligible for PoVW rewards. Before staking, any proving work done ***is not*** eligible for rewards. Only work done after staking $ZKC is eligible for PoVW rewards, and this is *effective immediately* i.e. provers **do not** have to wait after staking for the next reward epoch after staking to begin proving.   
* Once provers have staked, any work done immediately after staking is eligible for rewards in the current reward epoch.   
* Any work done after staking by a prover will be eligible  
* Provers generate ZK proofs with the POVW feature enabled in Bento.  
* Towards the end of an epoch, the prover must verify their work done to the PoVW contracts using the PoVW CLI:

1. The `prove-update` command compresses all local work receipts to reflect work done during any given epoch \- this update is stored in a local “state” file.  
2. The `send-update` command signs the work log update using the Log ID’s key and posts the update to the PoVW contracts.   
3. The prover waits for the current reward epoch to finalize. This allows all work log updates to be tallied, and all the respective rewards for each log ID to be calculated.  
4. Once the epoch has been finalized, the `claim-reward` command can be used to claim any unclaimed rewards. `claim-reward` uses Steel to query all work log updates and verify reward calculations. This process requires *both* a valid archive node RPC endpoint and a Beacon chain RPC endpoint. Quicknode offers both types of nodes with their paid plan. Claiming rewards does not have to be done every epoch; all unclaimed rewards from past epochs will be claimed automatically on the next valid `claim-reward` call.

## Recommended Practices

### Key Separation

In PoVW, the prover specifies the Log ID which must be a valid Ethereum address. This **does not** have to be the same as the $ZKC staking wallet address or a Boundless prover address, though it can be used for all three purposes. Note that PoVW rewards are eligible for *all verifiable work*, not solely work done to prove Boundless market orders. Therefore, provers not connected to the Boundless market are still eligible for $ZKC rewards, provided they are proving during the epoch and they have staked $ZKC.

#### Separating the Staking Wallet from the Log ID

When [enabling PoVW in Bento](#enabling-povw-in-bento), provers specify the following environment variables:

```bash
export POVW_LOG_ID="0x0000...0000"
export POVW_PRIVATE_KEY="..."
```

To stake from a separate wallet, provers may additionally specify:

```bash
export ZKC_WALLET_ADDRESS="0x0000...0000"
export PRIVATE_KEY="..."
```

Provers can now follow the [staking instructions](#TODO) to stake $ZKC from the `ZKC_WALLET_ADDRESS`. Once staked, provers must delegate rewards i.e. associate the `POVW_LOG_ID` with `ZKC_WALLET_ADDRESS`. This is done with the following command:

```bash
boundless zkc delegate-rewards ${POVW_LOG_ID}
```

This command uses the `PRIVATE_KEY` environment variable to send a transaction onchain, therefore funds are required on `ZKC_WALLET_ADDRESS`.

Once the rewards are delegated, the prover can continue with the normal reward claiming workflow starting with [Running Valid Work](#running-valid-work).

#### Separating the Staking Wallet from the Value Recipient

Additionally, the prover can specify a separate Ethereum address to receive the $ZKC reward. By default this is the log ID, but you can override it with `--value-recipient <address>` when running `send‑update`. 

#### Separating Keys when runnning a Boundless Prover

Since many Boundless provers run clusters on hosted cloud providers, and because the private key must be in plaintext when starting the broker, the security of this wallet depends on your trust in the cloud provider. Therefore, for provers running large proving/ZK-mining clusters with large expected $ZKC reward amounts, it is not recommended to use your Boundless proving address as the value recipient. If the key is compromised, this can lead to a loss of rewards and require new wallet setup to resume proving. 

At the minimum, we recommend most provers separate their value recipient address, such that:

* Boundless Prover Address \+ Log ID Address can be the same  
* Value Recipient is a separate address

This setup allows the proving cluster to prove orders on the Boundless market and generate and post work log updates onchain to be eligible for rewards. It also means that after running `claim-reward`, the reward $ZKC is transferred to a separate address. Claiming rewards is a permissionless process and does not require access to the private key for the Log ID. 

### Keep the state file safe

`prove-update` uses a state file to track compressed work receipts. Loss of this state file **will result in the loss of all work that is not submitted**for the respective Log ID, meaning rewards for any work done since the last work log update (via `send-update`) **will be lost**. In this scenario, a new work log ID must be specified for Bento, and Bento should be restarted to allow further work to be recorded properly against the new Log ID. *To avoid this scenario, it is recommended to store the state file in a durable location.*